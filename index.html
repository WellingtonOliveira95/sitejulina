<!DOCTYPE html>
<html>
<head>
  <title>Gravar Vídeo</title>
  <style>
    #videoContainer {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      position: relative;
    }

    #videoPreview {
      width: 400px;
      height: 300px;
    }

    #watermark {
      position: absolute;
      bottom: 10px;
      right: 10px;
      color: white;
      font-size: 24px;
      font-weight: bold;
      opacity: 0.7;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div id="videoContainer">
    <video id="videoPreview" autoplay muted></video>
    <span id="watermark">4º Arraiá</span>
  </div>

  <button id="startButton">Gravar</button>

  <script>
    var mediaRecorder;
    var chunks = [];
    var videoPreview = document.getElementById('videoPreview');
    var startButton = document.getElementById('startButton');

    startButton.addEventListener('click', startRecording);

    function startRecording() {
      startButton.disabled = true;

      mediaRecorder = null;
      chunks = [];

      navigator.mediaDevices.getUserMedia({ video: true })
        .then(function(stream) {
          videoPreview.srcObject = stream;
          mediaRecorder = new MediaRecorder(stream);

          mediaRecorder.ondataavailable = function(e) {
            chunks.push(e.data);
          };

          mediaRecorder.onstop = function() {
            var videoBlob = new Blob(chunks, { type: 'video/webm' });
            chunks = [];

            var videoURL = URL.createObjectURL(videoBlob);
            var a = document.createElement('a');
            a.href = videoURL;
            a.download = 'video_with_watermark.webm';
            a.click();
            URL.revokeObjectURL(videoURL);

            startButton.disabled = false;
          };

          mediaRecorder.start();
          setTimeout(stopRecording, 30000); // Grava por 30 segundos
        })
        .catch(function(error) {
          console.error('Erro ao acessar a câmera: ', error);
          startButton.disabled = false;
        });
    }

    function stopRecording() {
      if (mediaRecorder && mediaRecorder.state !== 'inactive') {
        mediaRecorder.stop();
        videoPreview.srcObject = null;
      }
    }
  </script>
</body>
</html>